# コーディングルール

## 基本ルール

あなたは高度な問題解決能力を持つAIアシスタントです。以下の指示に従って、効率的かつ正確にタスクを遂行してください。

まず、ユーザーから受け取った指示を確認します：
<指示>
{{instructions}}
<!-- このテンプレート変数はユーザーの入力プロンプトに自動置換されます -->
</指示>

この指示を元に、以下のプロセスに従って作業を進めてください：

---

1. 指示の分析と計画
   <タスク分析>
   - 主要なタスクを簡潔に要約してください。
   - 記載された技術スタックを確認し、その制約内での実装方法を検討してください。  
     **※ 技術スタックに記載のバージョンは変更せず、必要があれば必ず承認を得てください。**
   - 重要な要件と制約を特定してください。
   - 潜在的な課題をリストアップしてください。
   - タスク実行のための具体的なステップを詳細に列挙してください。
   - それらのステップの最適な実行順序を決定してください。

   ### 重複実装の防止

   実装前に以下の確認を行ってください：
   - 既存の類似機能の有無
   - 同名または類似名の関数やコンポーネント
   - 重複するAPIエンドポイント
   - 共通化可能な処理の特定

   このセクションは、後続のプロセス全体を導くものなので、時間をかけてでも、十分に詳細かつ包括的な分析を行ってください。
   </タスク分析>

---

2. タスクの実行
   - 特定したステップを一つずつ実行してください。
   - 各ステップの完了後、簡潔に進捗を報告してください。
   - 実装時は以下の点に注意してください：
     - 適切なディレクトリ構造の遵守
     - 命名規則の一貫性維持
     - 共通処理の適切な配置

---

3. 品質管理と問題対応
   - 各タスクの実行結果を迅速に検証してください。
   - エラーや不整合が発生した場合は、以下のプロセスで対応してください：
     a. 問題の切り分けと原因特定（ログ分析、デバッグ情報の確認）
     b. 対策案の作成と実施
     c. 修正後の動作検証
     d. デバッグログの確認と分析

   - 検証結果は以下の形式で記録してください：
     a. 検証項目と期待される結果
     b. 実際の結果と差異
     c. 必要な対応策（該当する場合）

---

4. 最終確認
   - すべてのタスクが完了したら、成果物全体を評価してください。
   - 当初の指示内容との整合性を確認し、必要に応じて調整を行ってください。
   - 実装した機能に重複がないことを最終確認してください。

---

5. 結果報告
   以下のフォーマットで最終的な結果を報告してください：

   ```markdown
   # 実行結果報告

   ## 概要
   [全体の要約を簡潔に記述]

   ## 実行ステップ
   1. [ステップ1の説明と結果]
   2. [ステップ2の説明と結果]
   ...

   ## 最終成果物
   [成果物の詳細や、該当する場合はリンクなど]

   ## 課題対応（該当する場合）
   - 発生した問題と対応内容
   - 今後の注意点

   ## 注意点・改善提案
   - [気づいた点や改善提案があれば記述]
   ```

---

### 重要な注意事項

- 不明点がある場合は、作業開始前に必ず確認を取ってください。
- 重要な判断が必要な場合は、その都度報告し、承認を得てください。
- 予期せぬ問題が発生した場合は、即座に報告し、対応策を提案してください。
- **明示的に指示されていない変更は行わないでください。** 必要と思われる変更がある場合は、まず提案として報告し、承認を得てから実施してください。
- **特に UI/UXデザインの変更（レイアウト、色、フォント、間隔など）は禁止**とし、変更が必要な場合は必ず事前に理由を示し、承認を得てから行ってください。
- **技術スタックに記載のバージョン（APIやフレームワーク、ライブラリ等）を勝手に変更しないでください。** 変更が必要な場合は、その理由を明確にして承認を得るまでは変更を行わないでください。

## 1. システム概要

KitchenCompassは、日々の食事の計画と準備をサポートするパーソナルな食事管理システムです。献立、レシピ管理、買い物リストのプランニングを一元管理し、日々の食事作りを効率化します。レシピを個人的に記録し、献立に反映させ、必要な食材を買い物リストに簡単に追加できる統合システムを提供します。

## 2. 機能要件

### 2.1 献立管理機能

#### 2.1.1 カレンダー形式の献立表示

- 日単位、 3日単位、週単位での献立表示（月単位は見づらくなるため非採用）
- 朝食、昼食、夕食などの食事区分ごとの管理
- ドラッグ&ドロップによる献立の移動・調整

#### 2.1.2 献立へのメニュー追加

- 所有レシピからの検索と追加
- レシピのないメニューを献立に追加した際、レシピページを追加するかどうかを確認
  - 承諾があれば自動追加
- お気に入りや最近使用したメニューからの素早い追加

#### 2.1.3 献立テンプレート

- よく使う献立パターンをテンプレートとして保存
- テンプレートを特定の日付範囲に適用

#### 2.1.4 栄養バランス表示(将来機能)

- 献立の栄養バランス概算表示（将来機能）
- 栄養素バランスのビジュアル化

#### 2.1.5 外食予定管理

- 献立カレンダーに外食予定を登録
- 外食ステータスとして区別管理（メニューではなく、外食という別カテゴリとして管理）
- 外食先や店名、メモなどの入力

### 2.2 レシピ管理機能

#### 2.2.1 レシピ登録

- 料理名、材料、手順、調理時間などの基本情報登録
- 料理区分（カテゴリ）の設定
- 調理器具の登録
- 外部レシピURLの保存機能
- 画像のアップロード

#### 2.2.2 レシピ検索・閲覧

- キーワード検索（料理名、材料、カテゴリなど）
- お気に入り登録とフィルタリング
- レシピ詳細表示
- レシピの評価・メモ機能

#### 2.2.3 レシピの自動作成

- 献立に追加された未登録メニューのレシピテンプレート自動作成
- メニュー名だけで仮レシピページを生成

#### 2.2.4 レシピ変換

- 人数に応じた材料量の自動調整
- 計量単位の変換（g/mlなど）

### 2.3 買い物リスト管理機能

#### 2.3.1 買い物リスト作成

- 手動での買い物アイテム追加
- レシピから直接材料を買い物リストに追加
- 複数日の献立から一括で買い物リストを生成
- 買い物アイテムのカテゴリ分け（野菜、肉、調味料など）

#### 2.3.2 買い物リスト操作

- 買い物完了アイテムのチェック機能
- アイテムの数量・単位の編集
- リストの並べ替え（カテゴリ順、追加順など）
- 定期的に買うアイテムのテンプレート化

#### 2.3.3 買い物リスト共有（将来機能）

- 家族などと買い物リストを共有
- リアルタイム更新

### 2.4 機能連携

#### 2.4.1 献立からレシピへの連携

- 献立表からレシピへの直接アクセス
- レシピのないメニューを献立に追加した際の自動レシピページ作成

#### 2.4.2 献立から買い物リストへの連携

- 指定した日付範囲の献立から必要な材料を買い物リストに一括追加
- 重複する材料の自動集計

#### 2.4.3 レシピから買い物リストへの連携

- レシピ画面から直接買い物リストに材料追加
- 必要な数量の指定（人数に応じた自動計算）

### 2.5 ユーザー管理機能

#### 2.5.1 ユーザー認証

- サインアップ、ログイン、ログアウト
- パスワードリセット
- 認証情報の管理（Amazon Cognito）

#### 2.5.2 ユーザープロフィール

- 基本情報の設定（名前、アイコンなど）
- 好みや制限の設定（アレルギー、好みの味など）（将来機能）

### 2.6 データ管理機能

#### 2.6.1 データのバックアップ・復元

- クラウドへのデータ自動バックアップ
- データのエクスポート・インポート

#### 2.6.2 データ同期（将来機能）

- 複数デバイス間でのデータ同期（Amplify DataStore）
- オフライン対応（オフライン時の編集とオンライン復帰時の同期）

### 3.4 機能制限事項

#### 3.4.1 初期開発における機能制限

- **ユーザー間連携機能**: レシピの公開など他のユーザーとの交流機能は初期開発時点では実装しない。将来的な機能拡張時に検討する。
- **データ同期機能**: 複数デバイス間でのデータ同期機能は初期フェーズでは実装しない。ローカルでの利用を前提とする。
- **プロフィール公開機能**: ユーザープロフィールの公開やユーザー間のコミュニケーション機能は初期版では提供しない。

## 4. 技術的制約

### 4.1 フロントエンド技術選定（決定：React + TypeScript + Material-UI）

#### 技術スタック決定事項

- **フロントエンドフレームワーク**: React
  - React関連のエラー発生時はPlaywrightで以下URLを参照すること
  - <https://ja.react.dev/reference/react>
- **言語**: TypeScript
- **UIフレームワーク**: Material-UI（MUI）
- **ビルドツール**: Vite

### 4.2 バックエンド技術選定

#### AWS Amplify Gen2の採用

#### バックエンド技術スタック詳細

- **クラウドプラットフォーム**: AWS Amplify Gen2
  - 操作時は以下URLにPlaywrightでアクセスし、情報を取得すること。
  - <https://docs.amplify.aws/>
- **サーバーレス関数**: AWS Lambda
  - **ランタイム言語**: Python 3系
- **データベース**: Amazon DynamoDB（NoSQL）
- **認証**: Amazon Cognito
- **API**: GraphQL API (AWS AppSync) / REST API (API Gateway)
- **ストレージ**: Amazon S3
- **CDN**: Amazon CloudFront

必要な場合、AWSドキュメントはaws documents mcpから取得して参考にすること。

## 5. インターフェース要件

### 5.1 ユーザーインターフェース

#### 5.1.1 全体デザインシステム

- Material-UIのデザインガイドラインに準拠
- 一貫性のあるカラースキーム（プライマリーカラー：緑系、アクセントカラー：オレンジ系）
- レスポンシブデザインによる様々なデバイス対応（モバイル、タブレット、デスクトップ）
- ダークモード/ライトモードの切り替え機能（システム設定、または手動切り替え）

#### 5.1.2 全体レイアウト構造

- 左ナビゲーションドロワー（メイン機能間の移動用）
- 上部アプリバー（現在のページ名表示、検索ボックス、設定メニュー）
- メインコンテンツエリア（各機能のメイン画面表示）
- 右下に配置するFloating Action Button（新規レシピ作成、献立追加などの主要アクション用）

#### 5.1.3 主要画面のUI要件

##### 献立カレンダー画面

- 表示単位切替タブ（日単位、3日単位、週単位）
- 簡潔で見やすいカレンダーグリッド表示
- 朝食、昼食、夕食を色分けしたセル表示
- ドラッグ＆ドロップによる直感的な献立移動
- 外食予定をアイコンで視認性高く表示

##### レシピリスト画面

- カードビュー形式のレシピ一覧（料理名、画像、調理時間）
- レスポンシブグリッドレイアウト（画面サイズに応じて表示数を最適化）
- 検索とフィルタ機能（キーワード、カテゴリ、調理時間など）
- 無限スクロール対応（データの適切な分割取得と表示）

##### レシピ詳細画面

- セクション分けされたレイアウト（概要、材料、手順、メモ）
- 材料一覧のチェックボックス機能（買い物リスト追加時に利用）
- 手順のステップごとの表示
- レシピメニュー（献立に追加、買い物リストに材料追加、編集、お気に入り登録など）

##### 買い物リスト画面

- チェックボックス付きリスト表示（完了済みアイテムは打消し線表示）
- カテゴリ別グループ化表示（野菜、肉類、調味料など）
- ドラッグ機能で順序変更可能
- 新規アイテム追加フォーム（インライン編集可能）

#### 5.1.4 インタラクションデザイン

- モーションとアニメーション（画面遷移、リスト更新時など）
- トースト通知（アクション実行時のフィードバック）
- スクロール動作の最適化（無限スクロール、仮想スクロール）
- タッチ/クリック操作でのフィードバック（選択時、操作成功時等）

#### 5.1.5 レスポンシブデザイン

- Material-UIのBreakpointsを活用した画面サイズ対応
  - モバイル（xs, sm）: シンプルな単一カラムレイアウト
  - タブレット（md）: 2カラムレイアウト
  - デスクトップ（lg, xl）: 複数カラムとサイドパネル活用
- 線形のサイドナビゲーション（モバイルではドロワー、大画面では固定）

#### 5.1.6 フォームデザイン

- Material-UIのフォームコントロールを統一的に使用
- リアルタイムバリデーション（入力時のフィードバック）
- オートコンプリート機能（レシピ検索や材料入力時）
- 日付選択にはMaterial-UIのDate Pickerコンポーネントを使用

#### 5.1.7 アクセシビリティ

- WCAG 2.1 AAレベルの適合性を目指す
- 適切な色コントラストの確保（4.5:1以上）
- スクリーンリーダー対応のARIA属性設定

#### 5.1.8 パフォーマンス最適化

- コンポーネントの過度な再レンダリングを避ける設計
- 大量データ表示時の仮想化（React Windowなどの活用）
- 画像の適切な最適化と遅延ロード
- インタラクション時のパフォーマンス維持（60fpsの滑らかな動作）
